---
import LinkPreview from './LinkPreview.astro';
import { marked } from 'marked';

export interface Props {
  title: string;
  content: string;
  publishDate: Date;
  slug: string;
  link?: string;
  linkTitle?: string;
}

const { title, content, publishDate, slug, link, linkTitle } = Astro.props;

// Convert markdown to HTML
const htmlContent = marked(content);

const formatTimeAgo = (date: Date) => {
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  
  if (diffDays >= 1) {
    return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
  } else if (diffHours >= 1) {
    return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
  } else {
    return 'just now';
  }
};
---

<article class="micro-post">
  <div class="micro-meta">
    <time datetime={publishDate.toISOString()}>
      {formatTimeAgo(publishDate)}
    </time>
  </div>
  <h3 class="micro-title">
    <a href={`/updates/${slug}`}>{title}</a>
  </h3>
  <div class="micro-content">
    <div set:html={htmlContent} />
    {link && linkTitle && (
      <LinkPreview url={link} title={linkTitle} />
    )}
  </div>
</article>